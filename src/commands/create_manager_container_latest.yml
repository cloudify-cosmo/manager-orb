description: >
  This command checks py3 compat for a plugin
steps:
  - run:
      name: "Pull Submodules"
      command: git submodule update --init --recursive --remote
  - attach_workspace:
      at: workspace
  - run:
      name: update pip
      command: pip install -U pip===20.3.3
  - run:
      name: get wget
      command: sudo apt-get install -y wget
  - run:
      name: install cloudify
      command: pip install -r test-requirements.txt
  - run:
      name: download manager docker image
      command:  wget http://repository.cloudifysource.org/cloudify/6.2.0/ga-release/cloudify-manager-aio-docker-6.2.0-ga.tar
  - run:
      name: load docker manager image
      command: docker load -i cloudify-manager-aio-docker-6.2.0-ga.tar
  - run:
      name: show images
      command: docker images
  - run:
      name: start docker container
      command: docker run --name cfy_manager -d --restart unless-stopped -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /run/lock --security-opt seccomp:unconfined --cap-add SYS_ADMIN --network host cloudify-manager-aio-x86_64
  - run:
      name: wait for starter
      command: docker exec -it cfy_manager cfy_manager wait-for-starter
  - run:
      name: install local project
      command: pip install https://github.com/cloudify-incubator/cloudify-ecosystem-test/archive/latest.zip
